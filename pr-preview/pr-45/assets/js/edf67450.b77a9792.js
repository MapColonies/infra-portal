"use strict";(self.webpackChunkinfra_portal=self.webpackChunkinfra_portal||[]).push([[2154],{8837:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"knowledge-base/jobnik/README","title":"README","description":"automated factory","source":"@site/docs/knowledge-base/jobnik/README.md","sourceDirName":"knowledge-base/jobnik","slug":"/knowledge-base/jobnik/","permalink":"/infra-portal/pr-preview/pr-45/docs/knowledge-base/jobnik/","draft":false,"unlisted":false,"editUrl":"https://github.com/MapColonies/infra-portal/tree/master/docs/knowledge-base/jobnik/README.md","tags":[],"version":"current","frontMatter":{},"sidebar":"knowledgeBaseSidebar","previous":{"title":"Default configs","permalink":"/infra-portal/pr-preview/pr-45/docs/knowledge-base/config-management/default-configs"},"next":{"title":"Boilerplate","permalink":"/infra-portal/pr-preview/pr-45/docs/knowledge-base/jobnik/boilerplate/"}}');var s=r(74848),i=r(28453);const a={},o="Jobnik Job Management System Architecture",l={},c=[{value:"System Overview",id:"system-overview",level:2},{value:"1. Job Manager",id:"1-job-manager",level:2},{value:"2. Jobnik SDK",id:"2-jobnik-sdk",level:2},{value:"3. Worker Boilerplate",id:"3-worker-boilerplate",level:2},{value:"Integration Flow",id:"integration-flow",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",img:"img",li:"li",mermaid:"mermaid",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"automated factory",src:r(2460).A+"",width:"1024",height:"559"})}),"\n",(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"jobnik-job-management-system-architecture",children:"Jobnik Job Management System Architecture"})}),"\n",(0,s.jsx)(n.p,{children:"This document provides a high-level architectural overview of the Jobnik Job Management system. It outlines the primary components, their roles, and how they integrate to facilitate distributed task management and workflow orchestration."}),"\n",(0,s.jsx)(n.p,{children:"For detailed implementation guides, configuration references, and API documentation, please refer to the specific repositories linked in each section."}),"\n",(0,s.jsx)(n.h2,{id:"system-overview",children:"System Overview"}),"\n",(0,s.jsx)(n.p,{children:"Jobnik is a distributed job management ecosystem designed to handle complex, hierarchical workflows. It separates the orchestration logic (state management, queuing, persistence) from the execution logic (task processing), allowing for scalable and resilient distributed systems."}),"\n",(0,s.jsx)(n.p,{children:"The architecture consists of three main pillars:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Jobnik Manager:"})," The central service responsible for state and persistence."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Jobnik SDK:"})," The library handling communication, resilience, and type safety."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Worker Boilerplate:"})," A standardized scaffolding for building task-processing services."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"1-job-manager",children:"1. Job Manager"}),"\n",(0,s.jsx)(n.p,{children:"The Job Manager acts as the central orchestration service and the single source of truth for the system. It exposes a RESTful API that enables external services to create jobs, track progress, and manage task queues."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Responsibilities:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Hierarchical Data Management:"})," Manages the relationships between ",(0,s.jsx)(n.strong,{children:"Jobs"})," (the root entity), ",(0,s.jsx)(n.strong,{children:"Stages"})," (logical groupings of tasks), and ",(0,s.jsx)(n.strong,{children:"Tasks"})," (atomic units of work)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"State Management:"})," Enforces valid state transitions using internal state machines. This prevents invalid operations, such as adding tasks to a completed stage or processing a cancelled job."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Persistence:"})," Stores all workflow data, status history, and operational metadata in a PostgreSQL database."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Queue Management:"})," Implements priority-based task dequeuing logic, ensuring high-priority jobs are processed first."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Task Health Management:"})," Monitors and handles 'forgotten' tasks to ensure no work becomes stale. This includes detecting tasks that have been in-progress for too long and recovering from worker failures."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Observability:"})," Emits standardized metrics (Prometheus) and distributed traces (OpenTelemetry) to monitor system health and request flows."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/MapColonies/jobnik-manager",children:"Link to Job Manager Repository"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"2-jobnik-sdk",children:"2. Jobnik SDK"}),"\n",(0,s.jsx)(n.p,{children:"The Jobnik SDK is a TypeScript library that abstracts the complexity of communicating with the Job Manager. It provides a typed, resilient communication layer used by both producers (services that create work) and consumers (services that perform work)."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Components:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Producer Client:"})," A client designed for services that initiate workflows. It handles the creation of Jobs, Stages, and Tasks, automatically managing trace context propagation."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Worker Client:"})," A client designed for task processing services. It manages the task lifecycle loop: polling for tasks, executing business logic, and updating task status (Completed/Failed) upon conclusion."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Core Capabilities:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type Safety:"})," Leverages TypeScript Generics to allow developers to define custom schemas for Job, Stage, and Task data. This ensures that payloads passed between Producers and Workers are typed and validated at compile time."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Resilience:"})," Built-in implementation of industry-standard stability patterns, including:\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Circuit Breakers:"})," Prevents cascading failures when the Job Manager is under load."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Exponential Backoff:"})," Manages retry logic for polling and network requests."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Graceful Shutdown:"})," Handles signal termination to ensure active tasks are completed or released before the service stops."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Automated Observability:"})," Automatically injects tracing headers into API calls and exposes worker-specific metrics (e.g., active tasks, task duration, success rates) without requiring manual instrumentation in the business logic."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"/infra-portal/pr-preview/pr-45/docs/knowledge-base/packages/jobnik-sdk/",children:"Link to Jobnik SDK"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"3-worker-boilerplate",children:"3. Worker Boilerplate"}),"\n",(0,s.jsx)(n.p,{children:"The Worker Boilerplate is a production-ready template repository designed to accelerate the development of new task-processing services. While not a runtime dependency, it serves as the standard starting point for building services that utilize the Jobnik SDK."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Purpose:"})}),"\n",(0,s.jsx)(n.p,{children:"It provides a pre-configured environment that integrates the Jobnik SDK with standard infrastructure requirements, allowing developers to focus solely on implementing the specific business logic for a task (e.g., image processing, data ingestion)."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Included Scaffolding:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Dependency Injection:"})," Pre-wired setup using ",(0,s.jsx)(n.code,{children:"tsyringe"})," for managing service dependencies."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Configuration Management:"})," Integration with standard configuration libraries for environment-based settings."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SDK Integration:"})," Example implementation of the SDK's ",(0,s.jsx)(n.code,{children:"Worker"})," client, demonstrating how to register task handlers and define custom types."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Deployment Assets:"})," Includes Dockerfiles and Helm charts aligned with infrastructure standards for rapid deployment."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"/infra-portal/pr-preview/pr-45/docs/knowledge-base/jobnik/boilerplate/",children:"Link to Worker Boilerplate Repository"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"integration-flow",children:"Integration Flow"}),"\n",(0,s.jsx)(n.mermaid,{value:'\nsequenceDiagram\nautonumber\n\n    box rgba(120, 120, 120, 0.7) "User Implementation"\n        participant Producer as Producer Service<br/>(SDK Client)\n        participant Worker as Worker Service<br/>(Boilerplate + SDK)\n    end\n\n    box rgba(120, 120, 120, 0.7) "User Implementation" "Jobnik Core"\n        participant Manager as Job Manager<br/>(REST API)\n        participant DB as PostgreSQL\n    end\n\n    participant Obs as Observability<br/>(Traces/Metrics)\n\n    Note over Producer, Worker: 1. Definition (Pre-runtime)\n\n    Note over Producer, DB: 2. Production Phase\n    Producer->>Manager: Create Job (Type-Safe Payload)\n    activate Manager\n    Manager->>DB: Persist Job Hierarchy\n    DB--\x3e>Manager: Success\n    Manager--\x3e>Producer: Return Job ID\n    deactivate Manager\n    Producer--)Obs: Emit Trace & Job Created Metric\n\n    Note over Worker, DB: 3. Consumption Phase\n    loop Polling Loop\n        Worker->>Manager: Dequeue Task (by Priority)\n        activate Manager\n        Manager->>DB: Lock & Retrieve Next Task\n        DB--\x3e>Manager: Task Record\n        Manager--\x3e>Worker: Return Task Data\n        deactivate Manager\n    end\n\n    Note over Worker: 4. Execution Phase\n    activate Worker\n    Worker->>Worker: Execute Business Logic\n\n    alt Success\n        Worker->>Manager: Update Status: COMPLETED\n    else Failure\n        Worker->>Manager: Update Status: FAILED\n    end\n    deactivate Worker\n\n    activate Manager\n    Manager->>DB: Update State & Transition\n    deactivate Manager\n\n    Note over Producer, Obs: 5. Monitoring (Continuous)\n    Worker--)Obs: Emit Task Duration & Success Rate\n    Manager--)Obs: Emit Queue Depth Metrics\n'})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},2460:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/jobnik-dcef64f936145dde53a3ba27f230e324.jpg"},28453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var t=r(96540);const s={},i=t.createContext(s);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);