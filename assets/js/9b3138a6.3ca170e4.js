"use strict";(self.webpackChunkinfra_portal=self.webpackChunkinfra_portal||[]).push([[8922],{351:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>n,toc:()=>u});const n=JSON.parse('{"id":"knowledge-base/monitoring/Prometheus","title":"Prometheus","description":"Overview","source":"@site/docs/knowledge-base/monitoring/prometheus.mdx","sourceDirName":"knowledge-base/monitoring","slug":"/knowledge-base/monitoring/Prometheus","permalink":"/infra-portal/docs/knowledge-base/monitoring/Prometheus","draft":false,"unlisted":false,"editUrl":"https://github.com/MapColonies/infra-portal/tree/master/docs/knowledge-base/monitoring/prometheus.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"Prometheus","title":"Prometheus","sidebar_position":3,"toc_min_heading_level":2,"toc_max_heading_level":5},"sidebar":"knowledgeBaseSidebar","previous":{"title":"BlackBox","permalink":"/infra-portal/docs/knowledge-base/monitoring/BlackBox"},"next":{"title":"Alertmanager","permalink":"/infra-portal/docs/knowledge-base/monitoring/Alertmanager"}}');var s=r(4848),a=r(8453);r(1470),r(9365);const o={id:"Prometheus",title:"Prometheus",sidebar_position:3,toc_min_heading_level:2,toc_max_heading_level:5},i="Prometheus",l={},u=[{value:"Overview",id:"overview",level:2},{value:"Home Screen Overview",id:"home-screen-overview",level:2},{value:"Prometheus Scrape Configuration",id:"prometheus-scrape-configuration",level:2},{value:"Configuring Your Service for Prometheus Scraping",id:"configuring-your-service-for-prometheus-scraping",level:3},{value:"Prometheus Alerts",id:"prometheus-alerts",level:2}];function c(e){const t={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"prometheus",children:"Prometheus"})}),"\n",(0,s.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(t.p,{children:"Prometheus is an open-source monitoring and alerting system designed to collect and store metrics as time series data.\nIt scrapes metrics from targets like applications pods and servers, stores them with the timestamp and labels\nand allows querying using PromQL. Prometheus is commonly used to track system performance and set up alerts based on defined\nconditions."}),"\n",(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsxs)(t.p,{children:["You can read more about Prometheus in the ",(0,s.jsx)(t.a,{href:"https://prometheus.io/docs/introduction/overview/",children:"Prometheus documentation"})]})}),"\n",(0,s.jsx)(t.h2,{id:"home-screen-overview",children:"Home Screen Overview"}),"\n",(0,s.jsxs)(t.p,{children:["You can access Libot's Prometheus at ",(0,s.jsx)(t.a,{href:"https://prometheus.mapcolonies.net",children:"https://prometheus.mapcolonies.net"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"The Prometheus home screen provides an overview of the current status of the Prometheus server.\nHere, you can see the targets that are being monitored, the current configuration of Prometheus,\nand access the built-in query interface."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"prometheus homescreen",src:r(1675).A+"",width:"1917",height:"421"})}),"\n",(0,s.jsx)(t.h2,{id:"prometheus-scrape-configuration",children:"Prometheus Scrape Configuration"}),"\n",(0,s.jsx)(t.p,{children:"Prometheus scrapes metrics from pods if they are in specific namespaces, properly annotated,\nand expose metrics on the specified port."}),"\n",(0,s.jsx)(t.h3,{id:"configuring-your-service-for-prometheus-scraping",children:"Configuring Your Service for Prometheus Scraping"}),"\n",(0,s.jsx)(t.p,{children:"To ensure your pod is scraped, it should be deployed in one of the listed namespaces and annotated correctly.\nThe required annotation looks like this:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:'  podAnnotations:\n    prometheus.io/scrape: "true"\n    prometheus.io/port: "10000"\n'})}),"\n",(0,s.jsx)(t.h2,{id:"prometheus-alerts",children:"Prometheus Alerts"}),"\n",(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsxs)(t.p,{children:["You can access the official ",(0,s.jsx)(t.a,{href:"https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/",children:"Prometheus alerting documentation"})]})}),"\n",(0,s.jsx)(t.p,{children:"Prometheus Alerts are rules defined in Prometheus that automatically trigger notifications when certain conditions are met,\nsuch as high CPU usage or service downtime."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"prometheus alerts",src:r(5555).A+"",width:"970",height:"420"})}),"\n",(0,s.jsx)(t.p,{children:"These alert rules are defined in Prometheus' configuration and are automatically evaluated."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'title="Alerts Config"',children:'alerting_rules.yml:\n  groups:\n    - name: blackbox_alerts\n      rules:\n        - alert: CertExpiration\n          expr: ((probe_ssl_earliest_cert_expiry{job="blackbox"} - time()) / 3600 / 24 < 30)\n          for: 90s\n          labels:\n            severity: \'critical\'\n          annotations:\n            description: "A certificate ({{ $labels.instance }}) is about to expire in 30 days!"\n            summary: "A certificate ({{ $labels.instance }}) is about to expire in 30 days!"\n'})}),"\n",(0,s.jsx)(t.admonition,{title:"Key Fields in Prometheus Alert Configuration",type:"info",children:(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"groups"}),": Organizes alerts into logical groups. Alerts within the same group are evaluated together."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"alert"}),": The name of the alert, which should describe the issue it triggers."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"expr"}),": The PromQL expression that defines when the alert should be triggered.\nIf the expression evaluates as true, the alert fires."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"for"}),": The amount of time the condition must be met before triggering the alert."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"labels"}),": Additional labels that provide context or are used for routing in Alertmanager."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"annotations"}),": Human-readable descriptions or summaries of the alert."]}),"\n"]})}),"\n",(0,s.jsxs)(t.p,{children:["To add, update, or remove an alert, you need to create a pull request in the repository\n",(0,s.jsx)(t.a,{href:"https://github.com/MapColonies/helm-charts/blob/master/infra/monitoring/values/alerts-values.yaml",children:"here"}),".",(0,s.jsx)(t.br,{}),"\n","After that, please notify the infra team for a review and upgrade."]})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},9365:(e,t,r)=>{r.d(t,{A:()=>o});r(6540);var n=r(4164);const s={tabItem:"tabItem_Ymn6"};var a=r(4848);function o(e){let{children:t,hidden:r,className:o}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,n.A)(s.tabItem,o),hidden:r,children:t})}},1470:(e,t,r)=>{r.d(t,{A:()=>w});var n=r(6540),s=r(4164),a=r(3104),o=r(6347),i=r(205),l=r(7485),u=r(1682),c=r(679);function d(e){return n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:r}=e;return(0,n.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:r,attributes:n,default:s}}=e;return{value:t,label:r,attributes:n,default:s}}))}(r);return function(e){const t=(0,u.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,r])}function m(e){let{value:t,tabValues:r}=e;return r.some((e=>e.value===t))}function p(e){let{queryString:t=!1,groupId:r}=e;const s=(0,o.W6)(),a=function(e){let{queryString:t=!1,groupId:r}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:t,groupId:r});return[(0,l.aZ)(a),(0,n.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(s.location.search);t.set(a,e),s.replace({...s.location,search:t.toString()})}),[a,s])]}function f(e){const{defaultValue:t,queryString:r=!1,groupId:s}=e,a=h(e),[o,l]=(0,n.useState)((()=>function(e){let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=r.find((e=>e.default))??r[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:a}))),[u,d]=p({queryString:r,groupId:s}),[f,g]=function(e){let{groupId:t}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(t),[s,a]=(0,c.Dv)(r);return[s,(0,n.useCallback)((e=>{r&&a.set(e)}),[r,a])]}({groupId:s}),b=(()=>{const e=u??f;return m({value:e,tabValues:a})?e:null})();(0,i.A)((()=>{b&&l(b)}),[b]);return{selectedValue:o,selectValue:(0,n.useCallback)((e=>{if(!m({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),g(e)}),[d,g,a]),tabValues:a}}var g=r(2303);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=r(4848);function x(e){let{className:t,block:r,selectedValue:n,selectValue:o,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:u}=(0,a.a_)(),c=e=>{const t=e.currentTarget,r=l.indexOf(t),s=i[r].value;s!==n&&(u(t),o(s))},d=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const r=l.indexOf(e.currentTarget)+1;t=l[r]??l[0];break}case"ArrowLeft":{const r=l.indexOf(e.currentTarget)-1;t=l[r]??l[l.length-1];break}}t?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":r},t),children:i.map((e=>{let{value:t,label:r,attributes:a}=e;return(0,v.jsx)("li",{role:"tab",tabIndex:n===t?0:-1,"aria-selected":n===t,ref:e=>l.push(e),onKeyDown:d,onClick:c,...a,className:(0,s.A)("tabs__item",b.tabItem,a?.className,{"tabs__item--active":n===t}),children:r??t},t)}))})}function j(e){let{lazy:t,children:r,selectedValue:a}=e;const o=(Array.isArray(r)?r:[r]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===a));return e?(0,n.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==a})))})}function y(e){const t=f(e);return(0,v.jsxs)("div",{className:(0,s.A)("tabs-container",b.tabList),children:[(0,v.jsx)(x,{...t,...e}),(0,v.jsx)(j,{...t,...e})]})}function w(e){const t=(0,g.A)();return(0,v.jsx)(y,{...e,children:d(e.children)},String(t))}},5555:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/prometheus-alerts-555671b0cfb98fe09d26fed172931781.png"},1675:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/prometheus-homescreen-01640e956f86778a80f3247b42bd1bed.png"},8453:(e,t,r)=>{r.d(t,{R:()=>o,x:()=>i});var n=r(6540);const s={},a=n.createContext(s);function o(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);